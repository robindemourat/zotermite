<!-- big container -->
<div  class="big-container animate-medium" ng-class="setBigContainerClass()" fitheight>

  <!-- left menu column -->
  <div class="column"
      ng-switch="leftMenuMode"
  >
    <div
      ng-include="setLeftMenuContent(leftMenuMode)"
    ></div>

    <div class="row bottom-group">
      <div class="btn-group flexed">
        <div
          class="btn"
          ng-class="{'active': leftMenuMode === 'about'}"
          ng-click="toggleLeftMenuMode('about')"
        >About</div>
        <div
          class="btn"
          ng-class="{'active': leftMenuMode === 'syntax'}"
          ng-click="toggleLeftMenuMode('syntax')"
        >Templating syntax</div>

        <div
          class="btn"
          ng-class="{'active': leftMenuMode === 'vocab'}"
          ng-click="toggleLeftMenuMode('vocab')"
        >Zotero vocabulary</div>
      </div>
    </div>
  </div><!-- end left menu column -->

  <!-- template column -->
  <div class="column">
    <div class="row step-header">

    </div>

    <div
      class="row long-container editor-container"
      fit-height
      fit-to-parent
    >
      <div class="consultable-container"
          fit-height=".editor-container"
          ng-show="!templateChoose"
       >
        <ui-codemirror
          fit-height=".editor-container"
          ui-codemirror-opts="editorOptions"
          ui-refresh='templateChoose'
          placeholder="type a template for markdown body"
          ng-model="activeTemplate"
        ></ui-codemirror>
      </div>
    </div>

    <div class="row bottom-group"
      ng-if="!templateChoose"
    >
      <div
        class="final-step btn-group"
      >
        <div
          class="btn animate-medium"
          id="templating-help"
          ng-if="!$scope.asides.left"
          ng-class="{'active' : asides.left && (leftMenuMode === 'syntax' || leftMenuMode === 'vocab')}"
          ng-click="toggleLeftMenuMode('syntax');toggleAside('left')"
        >
          <span class="glyphicon glyphicon-cloud-upload">Templating help</span>
        </div>
      </div>
    </div>

    <!--<div class="row bottom-group">
      <div class="row final-step btn-group">
        <div class="btn">help</div>
        <div class="btn">import</div>
        <div class="btn">save</div>
      </div>
    </div>-->


    <div
      class="moving-header animate-medium"
      ng-class="{'minified' : !templateChoose}"
    >

      <div class="animate-medium"
        ng-style="{'marginTop':(templateChoose)?'40%':'0'}"
      >
        <h2
          class="animate-medium"
          ng-class="{'big':templateChoose}"
          ng-click="toggleTemplateChoose(true)"
        ><span class="step-number">1</span> Set up a zotero-to-markdown template
        </h2>
        <div
        ng-if="templateChoose"
        >
          <p>
            Choose a template from this list :
          </p>

          <ul class="templates-list">
            <li
              class="template animate-medium"
              ng-repeat="template in templates track by $index"
              ng-bind="template.title"
              ng-class="{'active' : template.title === activeTemplate.title }"
              ng-click="getTemplate(template.title)"
            ></li>
          </ul>

          <p>
            ... or drag a template file (.txt, .md) in this zone
          </p>
        </div>


      </div>
    </div>


    <span class="absolute-top-left animate-medium mini-icon" ng-click="toggleAside('left')" style="color:white">
      <div
        class="nav-icon"
        ng-class="{'open':asides.left}"
      >
        <span></span>
        <span></span>
        <span></span>
      </div>
    </span>

  </div>
  <!--END COLUMN 1 -->

  <!-- COLUMN 2 -->
  <div class="column">
    <div class="row step-header">
      <h2>
      <span class="step-number">2</span> Select reference(s) in your zotero library</h2>
    </div>

    <div class="row selectors-container inline-options-container">
      <form class="inline-option inline-option-big inline-options-container animate" ng-submit="newZoteroQuery(searchQuery)">
        <input class="inline-option inline-option-big" type="text" placeholder="query your zotero library" ng-model="searchQuery">
        <input class="inline-option" type="submit">
      </form>
      <div
        class="inline-option btn animate"
        ng-click="addAllMatching()"
        ng-show="overallItems.length > 0"
      >
        Select all
      </div>
    </div>

    <div class="row results-display-container long-container animate-fast"fit-height fit-to-parent>
      <div class="consultable-container animate">

        <div class="loading"
          ng-show="overallItems.length == 0"
        >
          Loading
        </div>
        <div
          class="zotero-item animate"
          ng-repeat="item in overallItems | filter:searchInItem"
          ng-click="addToSelected($index)"
        >
          <span
            class="item-icon glyphicon"
            ng-class="setZoteroItemIcon(item.data.itemType)"
          ></span>
          <div class="zotero-item-primary-information">
            <h4 class="zotero-title" ng-bind="item.data.title"></h4>
            <p class="zotero-authors" ng-if="item.data.creators">
              <p ng-repeat="creator in item.data.creators track by $index">
                {{creator.firstName}} {{creator.lastName}}, {{creator.creatorType}}.
              </p>
            </p>
          </div>


          <div class="zotero-item-additional-information animate-medium">
            <p class="zotero-type"  ng-bind="'Item type : '+item.data.itemType">Type of entry</p>
            <p class="zotero-type"  ng-bind="(item.data.date)?'Date : '+item.data.date:'Date : unknown'">Date</p>
          </div>

          <div class="add-sign animate-medium">
            <span class="glyphicon glyphicon-arrow-right"></span>
          </div>
        </div>

        <div
          class="more-items"
          ng-click="getMore()"
          ng-show="overallItems.length > 0"
        >
          Fetch more items
        </div>
      </div>
    </div>



    <!-- <div class=" row bottom-group">

      <div class="row final-step inline-options-container">
        <div class="inline-option">API key</div>
        <form class="inline-option inline-options-container" ng-submit="changeAPIKey(apiKey)">
          <input class="inline-option" type="text" placeholder="paste your api key here" ng-model="apiKey">
          <input class="inline-option" type="submit">
        </form>
      </div>
    </div> -->
  </div>
  <!-- END COLUMN 2 -->

  <!-- COLUMN 3 -->
  <div class="column">
    <div class="row step-header">
      <h2>
      <span class="step-number">3</span>
      export markdown
      </h2>
    </div>
    <div class="row long-container" fit-height>
      <div
        class="consultable-container"
        marked="processedPreview"
      >
      </div>
    </div>

    <div class="row bottom-group">
      <div
        class="row selected-items-container animate-fast inline-options-container"
        ng-show="selectedItems.length > 0"
      >
        <h3 class="inline-option">
          {{selectedItems.length}} item<span ng-if="selectedItems.length > 1">s</span> selected for processing
        </h3>
        <span class="inline-option btn"
        ng-click="clearAllSelected()">
        </span>
      </div>
      <div class="selected-list-wrapper long-container">
        <div class="selected-list-container consultable-container animate-medium">
          <div
            class="zotero-item slide-height"
            ng-repeat="item in selectedItems track by $index"
            ng-click="removeFromSelected($index)"
          >
            <h4 class="zotero-title">
              <span class="remove glyphicon glyphicon-remove animate-medium"></span>
              <span class="confirm glyphicon glyphicon-ok animate-medium"></span>
              <span ng-bind="item.data.title"></span>
            </h4>
          </div>
        </div>
      </div>
      <div
        class="final-step btn-group"
        ng-if="selectedItems.length > 0"
      >
        <!--<div
            class="btn"
            ng-click="switchExportAsList()"
        >
            <span ng-if="!exportAsList">
              Export entries as a one-file list
            </span>
            <span ng-if="exportAsList">
              Export entries in seperate files
            </span>
        </div>-->
        <div
          class="btn animate-medium"
          clip-copy="copyToClipboard(selectedItems)"
        >
          <span class="glyphicon glyphicon-cloud-upload">Copy</span>
        </div>
        <div
          class="btn animate-medium"
          ng-click="downloadItems(selectedItems)"
        >
          <span class="glyphicon glyphicon-download">Download</span>
        </div>
      </div>
    </div>


    <span class="absolute-top-right animate-medium" ng-click="toggleAside('right')" style="color:white">
      <span class="glyphicon glyphicon-cog"></span>
    </span>
  </div>
  <!-- END COLUMN 3 -->


  <!-- right column -->
  <div class="column"
  >
    <div
      ng-include="'assets/html/options-export.html'"
    ></div>
  </div><!-- end right column-->


  <div class="container alerts">
        <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)" class="animate-fast">{{alert.msg}}</alert>
  </div>


</div><!--end big container -->
